# Events

DryerJS does not events by default.
However, you can easily add them by using a `General Hook` combines with `@nestjs/event-emitter`.
`NestJS` document can be found [here](https://docs.nestjs.com/techniques/events).

## Installation

First you need to install `@nestjs/event-emitter`:

```bash
npm i --save @nestjs/event-emitter
```

## Implementation

Below example, we create a `General Hook` to emit events when a record of any model is created, updated or removed.
Then there is a `EmailService` that listens to the `user.created` event and send a welcome email to the user.

```ts
import { Module } from '@nestjs/common';
import { EventEmitterModule, EventEmitter2 } from '@nestjs/event-emitter';

type Context = {};

@Hook(() => AllDefinitions)
class EventEmitterHook implements Hook<any, Context> {
  constructor(private readonly eventEmitter: EventEmitter2) {}

  async afterCreate(input: AfterCreateHookInputk<any, Context>) {
    const name = `${input.Definition.name}.created`;
    this.eventEmitter.emit(name, input);
  }

  async afterUpdate(input: AfterUpdateHookInputk<any, Context>) {
    const name = `${input.Definition.name}.updated`;
    this.eventEmitter.emit(name, input);
  }

  async afterRemove(input: AfterRemoveHookInputk<any, Context>) {
    const name = `${input.Definition.name}.removed`;
    this.eventEmitter.emit(name, input);
  }
}

@Injectable()
class EmailService {
  @OnEvent('user.created')
  async handleOrderCreatedEvent({ input }: AfterCreateHookInputk<User, Context>) {
    await this.sendWelcomeEmail({ email: input.email, name: input.name });
  }
}

@Module({
  imports: [
    // other imports
    EventEmitterModule.forRoot(),
    DryerModule.register({
      definitions: [User],
      hooks: [EventEmitterHook],
    }),
  ],
  providers: [EmailService],
})
export class AppModule {}
```
